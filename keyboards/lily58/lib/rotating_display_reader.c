#include <stdio.h>
#include <stdbool.h>
#include "timer.h"

// Rotation interval (in milliseconds)
#define ROTATION_INTERVAL_MS 1800000  // 30 minutes (more reasonable for testing)
// Other options:
// #define ROTATION_INTERVAL_MS 3600000  // 1 hour
// #define ROTATION_INTERVAL_MS 10000    // 10 seconds (for testing)

// Custom PiXeL16 logo - 128x32px bitmap  
static const char pixel16_logo[] PROGMEM = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xE0, 0xE0,
    0xE0, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xC0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
    0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
    0xE0, 0xE0, 0x80, 0x80, 0x00, 0x00,
    0x00, 0x00, 0x00, 0xE0, 0xE0, 0xE0,
    0xE0, 0xE0, 0x00, 0x00, 0x00, 0x00,
    0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0x00,
    0x00, 0x00, 0x00, 0xE0, 0xE0, 0xE0,
    0xE0, 0xE0, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x80, 0x80, 0xE0,
    0xE0, 0xE0, 0xE0, 0xE0, 0x00, 0x00,
    0x00, 0x00, 0x80, 0x80, 0xE0, 0xE0,
    0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
    0xE0, 0xE0, 0x80, 0x80, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x80, 0x80, 0x80,
    0x80, 0x80, 0xE0, 0xE0, 0xF8, 0xF8,
    0xFF, 0xFF, 0xFF, 0xF8, 0xF8, 0xE0,
    0xE0, 0x80, 0x80, 0x80, 0x80, 0x00,
    0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0x01, 0x01, 0x01, 0x01,
    0x01, 0x01, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0x00, 0x00, 0x00, 0x00, 0xF0,
    0xF9, 0xF9, 0xF9, 0xF9, 0x00, 0x00,
    0x00, 0x00, 0x0F, 0x0F, 0x7F, 0x7F,
    0xFF, 0xF8, 0xF8, 0xF8, 0xF8, 0x7F,
    0x7F, 0x7F, 0x0F, 0x0F, 0x00, 0xE0,
    0xE0, 0xF0, 0xF8, 0xF8, 0x38, 0x38,
    0x38, 0x38, 0xF8, 0xF8, 0xF0, 0xE0,
    0xE0, 0x00, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x3C, 0x3C, 0x3F,
    0x0F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0x81, 0x81, 0x81,
    0x81, 0x8F, 0x8F, 0x8F, 0x0F, 0x0F,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
    0x01, 0x01, 0x01, 0x01, 0x03, 0x03,
    0x0F, 0x0F, 0xFF, 0xFF, 0xFF, 0x0F,
    0x0F, 0x03, 0x03, 0x01, 0x01, 0x01,
    0x01, 0x00, 0x00, 0x00, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0x0F, 0x0F,
    0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F,
    0x01, 0x01, 0x01, 0x00, 0x00, 0x00,
    0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0x00, 0x00, 0x00, 0x00, 0xF0, 0xF0,
    0xFE, 0xFF, 0xFF, 0x0F, 0x0F, 0x0F,
    0x0F, 0xFF, 0xFF, 0xFE, 0xF0, 0xF0,
    0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0x0C, 0x0C, 0x0C, 0x0C, 0xCF, 0xCF,
    0xCF, 0xCF, 0x8F, 0x00, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0x80, 0xC0, 0xC0,
    0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x80,
    0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x01,
    0x01, 0x01, 0x01, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x03, 0x07,
    0x03, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x03, 0x07, 0x07, 0x07, 0x07, 0x03,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x03, 0x07, 0x07,
    0x07, 0x07, 0x00, 0x00, 0x00, 0x00,
    0x07, 0x07, 0x07, 0x07, 0x07, 0x00,
    0x00, 0x00, 0x00, 0x07, 0x07, 0x07,
    0x07, 0x03, 0x00, 0x01, 0x01, 0x03,
    0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
    0x07, 0x07, 0x03, 0x01, 0x01, 0x00,
    0x03, 0x07, 0x07, 0x07, 0x07, 0x07,
    0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
    0x07, 0x03, 0x00, 0x00, 0x00, 0x03,
    0x07, 0x07, 0x07, 0x07, 0x00, 0x00,
    0x00, 0x00, 0x01, 0x01, 0x03, 0x07,
    0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
    0x07, 0x03, 0x01, 0x01, 0x00, 0x00,
    0x00, 0x00,
};

/* COMMENTED OUT FOR TROUBLESHOOTING - Unused logo
// Ichigo logo - 128x32px bitmap
static const char ichigo_logo[] = {
  // 'ichigo', 128x32px
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 
  0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 
  0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 
  0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf7, 0x9f, 0xc0, 0x00, 0x00, 0x03, 0xc0, 0x03, 
  0xc0, 0x00, 0x18, 0x60, 0x00, 0x00, 0x00, 0x01, 0xff, 0x98, 0xc0, 0x00, 0x00, 0x0f, 0xe0, 0x03, 
  0xc0, 0x00, 0x7c, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x63, 0x18, 0xc0, 0x00, 0x00, 0x3c, 0x38, 0x03, 
  0xc0, 0x00, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x1f, 0xc0, 0x00, 0x00, 0x78, 0x1e, 0x03, 
  0xc0, 0x00, 0xff, 0xfc, 0x00, 0x1f, 0xff, 0xf8, 0x63, 0x18, 0xc7, 0xff, 0xf9, 0xe7, 0xe7, 0x03, 
  0xc0, 0x00, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x18, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x03, 
  0xc0, 0x7c, 0x7c, 0xf8, 0xf8, 0x00, 0x00, 0x00, 0x63, 0x1f, 0xc0, 0x00, 0x01, 0xff, 0xff, 0x03, 
  0xc1, 0xfe, 0x1c, 0xe1, 0xfe, 0x00, 0x00, 0x01, 0xff, 0x98, 0xc0, 0x00, 0x00, 0x0c, 0x38, 0x03, 
  0xc1, 0xff, 0x8c, 0xc7, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x18, 0xc0, 0x00, 0x00, 0x0c, 0x18, 0x03, 
  0xc0, 0xff, 0xe0, 0x1f, 0xf8, 0x00, 0x00, 0x00, 0x63, 0x63, 0xc0, 0x00, 0x00, 0x7f, 0xfe, 0x03, 
  0xc0, 0x3c, 0x07, 0x80, 0xf0, 0x00, 0x00, 0x01, 0xc2, 0x61, 0x00, 0x00, 0x00, 0x73, 0xe4, 0x03, 
  0xc0, 0xbc, 0x4f, 0x88, 0xf4, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 
  0xc3, 0xff, 0xef, 0x9f, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 
  0xc3, 0xff, 0x87, 0x87, 0xff, 0x0c, 0x3e, 0x31, 0x8c, 0x7c, 0x3e, 0x07, 0x1e, 0x31, 0xcf, 0xc3, 
  0xc1, 0xfe, 0x00, 0x01, 0xfc, 0x0c, 0x77, 0x31, 0x8c, 0xe4, 0x73, 0x07, 0x73, 0x31, 0xcc, 0x03, 
  0xc0, 0x7c, 0x7c, 0xf8, 0xf8, 0x0c, 0x60, 0x31, 0x8c, 0xc0, 0x63, 0x07, 0x70, 0x31, 0xcc, 0x03, 
  0xc0, 0x01, 0xfc, 0xfc, 0x00, 0x0c, 0x60, 0x3f, 0x8c, 0xce, 0x63, 0x07, 0x70, 0x3f, 0xcf, 0x83, 
  0xc0, 0x03, 0xfc, 0xff, 0x00, 0x0c, 0x60, 0x31, 0x8c, 0xc6, 0x63, 0x07, 0x70, 0x39, 0xcc, 0x03, 
  0xc0, 0x03, 0xff, 0xff, 0x00, 0x0c, 0x67, 0x31, 0x8c, 0xc6, 0x63, 0x07, 0x73, 0xb1, 0xcc, 0x03, 
  0xc0, 0x03, 0xff, 0xff, 0x00, 0x0c, 0x3e, 0x31, 0x8c, 0x7c, 0x3e, 0x07, 0x3f, 0x31, 0xdf, 0xc3, 
  0xc0, 0x01, 0xfc, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 
  0xc0, 0x00, 0x78, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 
  0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 
  0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 
  0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 
  0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 
  0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
};
*/

/* COMMENTED OUT FOR TROUBLESHOOTING - Unused logo
// Mindset is All logo - 32x128px bitmap (note: different orientation)
static const char mindset_logo[] = {
  // 'mindset_is_all', 32x128px
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x60, 0x00, 
  0x00, 0x00, 0x60, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x01, 0xc0, 0x00, 
  0x00, 0x01, 0xc0, 0x00, 0x00, 0x03, 0xc0, 0x00, 0x00, 0x18, 0x40, 0x80, 0x00, 0x3c, 0x01, 0x80, 
  0x00, 0x3d, 0x81, 0x00, 0x00, 0x7d, 0xc3, 0x00, 0x00, 0x7d, 0xe3, 0x00, 0x00, 0xcd, 0xf3, 0x00, 
  0x00, 0xcd, 0xff, 0x00, 0x00, 0xcd, 0xfe, 0x00, 0x01, 0xfd, 0xfe, 0x00, 0x01, 0xfd, 0xfe, 0x00, 
  0x01, 0xfd, 0xfe, 0x00, 0x00, 0xfd, 0xff, 0x00, 0x00, 0x7d, 0xf3, 0x00, 0x00, 0x7d, 0xe3, 0x00, 
  0x00, 0xf9, 0xc3, 0x00, 0x00, 0x7b, 0x81, 0x00, 0x00, 0x3b, 0x81, 0x00, 0x00, 0x00, 0xc0, 0x00, 
  0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0x05, 0x9b, 0x70, 
  0x09, 0x55, 0x9b, 0xf8, 0x0f, 0x55, 0xda, 0x20, 0x0f, 0x55, 0x52, 0x20, 0x0f, 0x5d, 0x5b, 0x20, 
  0x09, 0x5d, 0x5b, 0x20, 0x09, 0x4d, 0x4a, 0x20, 0x09, 0x05, 0x42, 0x20, 0x09, 0x45, 0xdb, 0x20, 
  0x09, 0x55, 0x9b, 0xa0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x10, 0x80, 0x00, 0x00, 0xb8, 0x96, 0x00, 0x00, 0xb8, 0x92, 0x00, 0x00, 0xa1, 0x92, 0x00, 
  0x00, 0xb0, 0x12, 0x00, 0x00, 0x99, 0x52, 0x00, 0x00, 0xd9, 0xd2, 0x00, 0x00, 0x89, 0x52, 0x00, 
  0x00, 0xb9, 0x52, 0x00, 0x00, 0xb9, 0x5f, 0x00, 0x00, 0x10, 0x1b, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
*/

// Display rotation variables
static uint32_t last_rotation_time = 0;
static uint8_t current_display = 0;
static const uint8_t total_displays = 3;

// Initialize rotation system
void init_rotating_display(void) {
  last_rotation_time = timer_read32();
  current_display = 0;
}

/* COMMENTED OUT FOR TROUBLESHOOTING - Unused function
// Check if it's time to rotate display
static void check_rotation_timer(void) {
  uint32_t current_time = timer_read32();
  
  if (current_time - last_rotation_time >= ROTATION_INTERVAL_MS) {
    current_display = (current_display + 1) % total_displays;
    last_rotation_time = current_time;
  }
}
*/

// Get current display content
const char *read_rotating_display(void) {
  // TEMPORARILY SIMPLIFIED - Just return PiXeL16 logo for troubleshooting
  return pixel16_logo;  // Your custom PiXeL16 logo
  
  /* COMMENTED OUT FOR TROUBLESHOOTING - Complex rotation logic
  // Initialize on first call
  static bool initialized = false;
  if (!initialized) {
    init_rotating_display();
    initialized = true;
  }
  
  check_rotation_timer();
  
  switch (current_display) {
    case 0:
      return pixel16_logo;  // Your custom PiXeL16 logo
    case 1:
      return ichigo_logo;   // Ichigo anime logo  
    case 2:
      return mindset_logo;  // Mindset is All logo
    default:
      return pixel16_logo;  // Fallback
  }
  */
}

// Get current display type (for different rendering methods)
uint8_t get_current_display_type(void) {
  // TEMPORARILY SIMPLIFIED - Always return type 0 (PiXeL16) for troubleshooting
  return 0;  // Always PiXeL16 type (128x32 bitmap)
  
  /* COMMENTED OUT FOR TROUBLESHOOTING - Complex rotation logic
  check_rotation_timer();
  // Return display type: 0=PiXeL16, 1=Ichigo, 2=Mindset (all bitmaps, but Mindset has different dimensions)
  return current_display;
  */
}

// Manual rotation trigger (for testing or user control)
void force_display_rotation(void) {
  current_display = (current_display + 1) % total_displays;
}
